<div class="header">
  <div class="row">
    <div class="col" style="display:flex">
      <img src="../../../../assets/img/Flowserve-Logo.jpg" class="logo">
      <p class="titleBBS">AUDITORIAS FLOWSERVE TLAXCALA</p>
    </div>
  </div>
</div>

<div class="container" *ngIf="firstTimeDom && userAccepted">
  <div class="card mt-5 text-center" style="width: 60%; margin:0px auto;">
    <h5 class="card-header">Auditado</h5>
    <div class="card-body">
      <h5 class="card-title">Nombre de la persona o personas a auditar</h5>
      <input type="text" class="form-field" placeholder="Auditado" matInput [(ngModel)]="auditado" style="width: 100%;"><br>
    </div>
    <div class="card-footer">
      <a class="btn btn-success" style="color:white;" (click)="primera()">Continuar</a>
    </div>
  </div>
</div>

<div class="container" *ngIf="!userAccepted">
  <div class="card mt-5 text-center" style="width: 60%; margin:0px auto;">
    <h5 class="card-header">Sistema de auditorías Flowserve Tlaxcala</h5>
    <div class="card-body">
      <h5 class="card-title">Introduce tu número de empleado GEMS</h5>
      <input type="text" class="form-field" placeholder="GEMS" matInput [(ngModel)]="gems" style="width: 100%;"><br>
        <div *ngIf="notAccepted" class="col-10 alert alert-danger mt-2" style="margin: 0px auto; width: 100%;">
          No hay auditorías para este usuario
        </div>
    </div>
    <div class="card-footer">
      <a class="btn btn-success" style="color:white;" (click)="checkUser()">Continuar</a>
    </div>
  </div>
</div>


<div class="container" *ngIf="userAccepted && !formFinished && !firstTimeDom">
  <div class="row">
    <div class="card col-10 text-white mb-3" style="margin: 0px auto; text-align: center; background-color: #E2231A;">
      <div class="card-header">
        <h5 class="card-title">{{bbsName}}</h5>
        <p class="card-text">Auditor: {{employeeName}}</p>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="card col-10 border-danger mb-3" style="min-height: 420px; margin: 0px auto;box-shadow: rgba(50, 50, 93, 0.25) 0px 6px 12px -2px, rgba(0, 0, 0, 0.3) 0px 3px 7px -3px;">
      <div class="card-header" style="width: 100%; text-align: center;">
        <div *ngFor="let question of preguntas; let i = index" class="questionBox">
          <div *ngIf="question.respuesta != undefined" class="btn" style="background-color: #E2231A; color:white" (click)="updateAnswers(selectedQuestion) ;selectedQuestion = i">
            {{i+1}}
          </div>
          <div *ngIf="question.respuesta == undefined" class="btn btn-light" (click)="updateAnswers(selectedQuestion) ;selectedQuestion = i" style="border:1px solid gray">
            {{i+1}}
          </div>
        </div>
      </div>

      <div class="card-body" style="padding-left: 0px !important; padding-right: 0px !important;">
        <h5 class="card-title">
          <div class="row" >
            <div class="col-6" style="margin:0px auto">
              <app-spinner></app-spinner>
            </div>
          </div>
          <div class="col-12 questionContainerBox" *ngFor="let question of preguntas; let i = index">
            <div class="form-group" *ngIf="selectedQuestion == i">
              <div class="row">
                <div class="col" style="min-height: 70px;">
                  <p class="pregunta">{{selectedQuestion+1}}. {{preguntas[i].pregunta}}</p>
                </div>
              </div>






              <div *ngIf="module =='BBS'">
                <div class="row" *ngIf="selectedQuestion != preguntas.length-1">
                  <div class="col" align="right">
                    <button (click)="functionYes(i)" *ngIf="question.respuesta == true" class="btn btn-success">Si</button>
                    <button (click)="functionYes(i)" *ngIf="question.respuesta != true" class="btn btn-dark">Si</button>
                  </div>
                  <div class="col" align="left">
                    <button (click)="functionNo(i)" *ngIf="question.respuesta == false" class="btn btn-success">No</button>
                    <button (click)="functionNo(i)" *ngIf="question.respuesta != false" class="btn btn-dark">No</button>
                  </div>
                </div>              
                <div class="row" *ngIf="selectedQuestion == preguntas.length-1">
                  <div class="col" align="center">
                    <input type="file" accept="image/*" (change)="captureFile($event)" [(ngModel)]="question.respuesta" capture="environment">
                    <label for="file-upload" class="custom-file-upload">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                        <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                      </svg> Subir imagen       
                    </label><br>
                    <input id="file-upload" type="file" (change)="captureFile($event)">
                    <div *ngFor="let previsualizaciones of previsualizacion[selectedQuestion]; let i = index">
                      <div style="border: 1px solid gray; width: auto; border-radius: 5px; margin: 5px; padding: 5px;">                            
                        <img [src]="previsualizaciones" class="fotografia"><br>
                        <button class="btn btn-danger" (click)="eliminarElemento(i)">Eliminar</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>






              <div *ngIf="module =='GembaWalk'">
                <div class="row">
                  <div class="col" align="right">
                    <button (click)="functionYes(i)" *ngIf="question.respuesta == true" class="btn btn-success">Si</button>
                    <button (click)="functionYes(i)" *ngIf="question.respuesta != true" class="btn btn-dark">Si</button>
                  </div>
                  <div class="col" align="left">
                    <button (click)="functionNo(i)" *ngIf="question.respuesta == false" class="btn btn-success">No</button>
                    <button (click)="functionNo(i)" *ngIf="question.respuesta != false" class="btn btn-dark">No</button>
                  </div>
                </div>
                <div class="row">
                  <div class="col" align="center">
                    <input type="file" accept="image/*" (change)="captureFile($event)" [(ngModel)]="question.respuesta" capture="environment">
                    <label for="file-upload" class="custom-file-upload">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                        <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                      </svg> Subir imagen
                    </label><br>
                    <input id="file-upload" type="file" (change)="captureFile($event)">
                    <div *ngIf="previsualizacion[selectedQuestion]">
                      <div *ngFor="let previsualizaciones of previsualizacion[selectedQuestion]; let i = index">
                        <div style="border: 1px solid gray; width: auto; border-radius: 5px; margin: 5px; padding: 5px;">                            
                          <img [src]="previsualizaciones" class="fotografia"><br>
                          <button class="btn btn-danger" (click)="eliminarElemento(i)">Eliminar</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>    
              
              




              <div class="row mt-2">
                <div class="col-10" style="margin: 0px auto;">
                  <p class="pregunta">Comentarios</p>
                  <textarea class="form-control" id="comentarios" rows="3" [(ngModel)]="question.comentarios" value="question.comentarios"
                  style="box-shadow: rgba(50, 50, 93, 0.25) 0px 6px 12px -2px, rgba(0, 0, 0, 0.3) 0px 3px 7px -3px;"></textarea>
                </div>
              </div>
            </div>
          </div>
        </h5>
      </div>







      <div class="card-footer text-muted">
        <div class="row">
          <div class="col" align="right">
            <button *ngIf="selectedQuestion>0" (click)="updateAnswers(selectedQuestion); selectedQuestion = selectedQuestion-1" class="btn" style=" background-color: #E2231A;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-arrow-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
              </svg>
            </button>
          </div>
          <div class="col" align="left">
            <button *ngIf="selectedQuestion<preguntas.length-1" (click)="updateAnswers(selectedQuestion); selectedQuestion = selectedQuestion+1" class="btn" style=" background-color: #E2231A;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-arrow-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
              </svg>
            </button>
            <button *ngIf="selectedQuestion == preguntas.length-1 && formReady" (click)="enviar()" class="btn" style=" background-color: #E2231A; color: white;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
              </svg> Terminar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>








  <div class="row mt-4 mb-4">
    <div class="col-10 alert alert-danger" style="margin: 0px auto">
      SI ENCUENTRAS UN PELIGRO QUE TENGA UN RIESGO ALTO PARA EL EMPLEADO O UN RESULTADO NEGATIVO EN LA AUDITORÍA, DETEN LA ACTIVIDAD Y NOTIFICA AL SUPERVISOR INMEDIATAMENTE
    </div>
  </div>
</div>

<div *ngIf="formFinished">
  <div class="row mt-4 mb-4">
    <div class="col-10 alert alert-success" style="margin: 0px auto">
      La auditoría fue contestada exitosamente, puedes cerrar esta ventana.
    </div>
  </div>
</div>